{% extends "bootstrap/base.html" %}
{% from 'macros.html' import navigation %}
{% block title %}Knowledge UI{% endblock %}

{% block head %}
{{ super() }}
<link rel="shortcut icon" href="#">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
  integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
<style type="text/css">
  .node {
    stroke: #fff;
    fill: #ddd;
    stroke-width: 1.5px;
  }

  .link {
    stroke: #999;
    stroke-opacity: .6;
    stroke-width: 1px;
  }

  marker {
    stroke: #999;
    fill: rgba(124, 240, 10, 0);
  }

  .node-text {
    font: 11px sans-serif;
    fill: black;
  }

  .link-text {
    font: 9px sans-serif;
    fill: grey;
  }

  svg {
    border: 1px solid black;
  }
</style>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());

  gtag('config', 'your_analytiks_tag');
</script>

<script src="https://d3js.org/d3.v3.min.js"></script>
<script>

  function filterNodesById(nodes, id) {
    return nodes.filter(function (n) { return n.id === id; });
  }

  function triplesToGraph(triples) {

    svg.html("");
    //Graph
    var graph = { nodes: [], links: [] };

    //Initial Graph from triples
    triples.forEach(function (triple) {
      var subjId = triple.subject;
      var predId = triple.predicate;
      var objId = triple.object;

      var subjNode = filterNodesById(graph.nodes, subjId)[0];
      var objNode = filterNodesById(graph.nodes, objId)[0];

      if (subjNode == null) {
        subjNode = { id: subjId, label: subjId, weight: 1 };
        graph.nodes.push(subjNode);
      }

      if (objNode == null) {
        objNode = { id: objId, label: objId, weight: 1 };
        graph.nodes.push(objNode);
      }


      graph.links.push({ source: subjNode, target: objNode, predicate: predId, weight: 1 });
    });

    return graph;
  }
</script>
{% endblock %}

{% block html_attribs %} lang="en"{% endblock %}

{% block content %}
<header class="pb-3 mb-4 border-bottom">
  <a href="/" class="d-flex align-items-center text-dark text-decoration-none m-3 pb-1">
    <img class='me-3' src="{{ logo }}" height="30" alt="mat-o-lab-logo" />
  </a>
</header>

<body class="bg-light rounded-3 px-3">
  {{navigation()}}
  <div id="svg-body" class="panel-body"></div>
  <script>

    var w = 960,
      h = 700,
      r = Math.min(w, h) / 2,
      color = d3.scale.category20c();
    var vis = d3.select("#svg-body").append("svg:svg")
      .attr("width", w)
      .attr("height", h)
      .append("svg:g")
      .attr("transform", "translate(" + w / 2 + "," + h / 2 + ")");
    var partition = d3.layout.partition()
      .sort(null)
      .size([2 * Math.PI, r * r])
      .value(function (d) { return 1; });
    var arc = d3.svg.arc()
      .startAngle(function (d) { return d.x; })
      .endAngle(function (d) { return d.x + d.dx; })
      .innerRadius(function (d) { return Math.sqrt(d.y); })
      .outerRadius(function (d) { return Math.sqrt(d.y + d.dy); });

    var nodeData = {
      "name": "TOPICS", "children": [{
        "name": "Topic A",
        "children": [{ "name": "Sub A1", "size": 4 }, { "name": "Sub A2", "size": 4 }]
      }, {
        "name": "Topic B",
        "children": [{ "name": "Sub B1", "size": 3 }, { "name": "Sub B2", "size": 3 }, {
          "name": "Sub B3", "size": 3
        }]
      }, {
        "name": "Topic C",
        "children": [{ "name": "Sub A1", "size": 4 }, { "name": "Sub A2", "size": 4 }]
      }]
    };


    var path = d3.select("svg-body")
        .data(nodeData)
        .enter().append("svg:path")
        .attr("display", function (d) { return d.depth ? null : "none"; }) // hide inner ring
        .attr("d", arc)
        .attr("fill-rule", "evenodd")
        .style("stroke", "#fff")
        .style("fill", function (d) { return color((d.children ? d : d.parent).name); })
        .each(stash);
      d3.select("#size").on("click", function () {
        path
          .data(partition.value(function (d) { return d.size; }))
          .transition()
          .duration(1500)
          .attrTween("d", arcTween);
        d3.select("#size").classed("active", true);
        d3.select("#count").classed("active", false);
      });

      d3.select("#count").on("click", function () {
        path
          .data(partition.value(function (d) { return 1; }))
          .transition()
          .duration(1500)
          .attrTween("d", arcTween);
        d3.select("#size").classed("active", false);
        d3.select("#count").classed("active", true);
      });
    // Stash the old values for transition.
    function stash(d) {
      d.x0 = d.x;
      d.dx0 = d.dx;
    }
    // Interpolate the arcs in data space.
    function arcTween(a) {
      var i = d3.interpolate({ x: a.x0, dx: a.dx0 }, a);
      return function (t) {
        var b = i(t);
        a.x0 = b.x;
        a.dx0 = b.dx;
        return arc(b);
      };
    }


  </script>
  {% with messages = get_flashed_messages() %}
  {% endwith %}
</body>

{% block footer %}
<footer class="pt-3 my-4 text-center text-muted border-top">
  <span class="site-footer-owner"><a href="https://github.com/Mat-O-Lab/KnowledgeUI">KnowledgeUI</a> is maintained by <a
      href="https://matolab.org"><img src="{{ logo }}" width="5%" alt="mat-o-lab-logo" /></a>.</span>
</footer>
{% endblock %}
{% endblock %}


{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
<script
  src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js?lang=css&amp;skin=sunburst"></script>
{{super()}}
{% endblock %}